<MudDialog @bind-IsVisible="IsVisible" Options="DialogOptions">
    <TitleContent>
        <MudText Typo="Typo.h6">Create New Trading Profile</MudText>
    </TitleContent>
    <DialogContent>
        <MudGrid>
            <MudItem xs="12" md="6">
                <MudTextField @bind-Value="NewProfile.Name"
                              Label="Profile Name"
                              Variant="Variant.Outlined"
                              Class="mb-3"
                              Required="true"/>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudSelect @bind-Value="NewProfile.RiskLevel"
                           Label="Risk Level"
                           Variant="Variant.Outlined"
                           Class="mb-3"
                           Required="true">
                    <MudSelectItem Value="@RiskLevel.Conservative">Conservative</MudSelectItem>
                    <MudSelectItem Value="@RiskLevel.Moderate">Moderate</MudSelectItem>
                    <MudSelectItem Value="@RiskLevel.Aggressive">Aggressive</MudSelectItem>
                </MudSelect>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudNumericField T="int" @bind-Value="NewProfile.MaxTotalPositions"
                                 Label="Max Total Positions"
                                 Variant="Variant.Outlined"
                                 Class="mb-3"
                                 Min="1" Max="50" Step="1"
                                 Required="true"/>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudNumericField T="int" @bind-Value="NewProfile.MinAIConfidence"
                                 Label="Min AI Confidence (%)"
                                 Variant="Variant.Outlined"
                                 Class="mb-3"
                                 Min="50" Max="95" Step="5"
                                 Required="true"/>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudNumericField T="decimal" @bind-Value="NewProfile.InitialPortfolioValue"
                                 Label="Initial Portfolio Value ($)"
                                 Variant="Variant.Outlined"
                                 Class="mb-3"
                                 Min="1000m" Max="1000000m" Step="1000m"
                                 Required="true"/>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudCheckBox @bind-Value="NewProfile.EnableAutoTrading"
                             Label="Enable Auto Trading"
                             Color="Color.Primary"/>
            </MudItem>
            <MudItem xs="12">
                <MudTextField @bind-Value="NewProfile.Description"
                              Label="Description"
                              Variant="Variant.Outlined"
                              Class="mb-3"
                              Lines="3"/>
            </MudItem>
        </MudGrid>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="OnCancel">Cancel</MudButton>
        <MudButton Color="Color.Primary" OnClick="OnSave">Save Profile</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [Parameter] public bool IsVisible { get; set; }
    [Parameter] public EventCallback<bool> IsVisibleChanged { get; set; }
    [Parameter] public TradingProfile NewProfile { get; set; } = new();
    [Parameter] public EventCallback<TradingProfile> OnSaveRequested { get; set; }

    private DialogOptions DialogOptions => new() { CloseOnEscapeKey = true, MaxWidth = MaxWidth.Medium };

    private async Task OnCancel()
    {
        IsVisible = false;
        await IsVisibleChanged.InvokeAsync(false);
    }

    private async Task OnSave()
    {
        await OnSaveRequested.InvokeAsync(NewProfile);
        IsVisible = false;
        await IsVisibleChanged.InvokeAsync(false);
    }

}
